from scapy.layers.inet import ICMP, IP
from scapy.all import get_if_addr, sr1
from scapy.packet import Packet
from libs.aux_funcs import type_wrapper,attack_cat,attack_layer,attack_type

@type_wrapper(name="ICMP Flood", type=attack_type.DoS, category=attack_cat.Attack, layer=attack_layer.L4, arg_list=[])
def icmp_flood(args):
    return ICMP()

@type_wrapper(name="Ping test", type=attack_type.Test, category=attack_cat.Attack, layer=attack_layer.L2, arg_list=['dest_ip'])
def icmp_test(args):
    iface=args["interface"]
    dst_ip = args["dest_ip"]

    if pkt != None:
        if pkt.haslayer(IP):
            pkt = pkt/ICMP()
        else:
            pkt = pkt/IP(dst = dst_ip, src=get_if_addr(iface))/ICMP()
    else:
        pkt = IP(dst=dst_ip, src=get_if_addr(iface))/ICMP()
    
    rsp = sr1(pkt, iface=iface)
    if rsp != None:
        print("ICMP Response received")
    else:
        print("No ICMP Response")